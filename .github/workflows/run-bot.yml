name: Run Trading Bot (Continuous Mode)

on:
  schedule:
    # ‚è∞ Cada 30 minutos, 24/7
    - cron: "*/30 * * * *"
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 25

    steps:
      # ==========================================================
      # üß© 1Ô∏è‚É£ PREPARAR ENTORNO
      # ==========================================================
      - name: üöÄ Iniciando Trading Bot...
        run: echo "üöÄ Iniciando Trading Bot..."

      - name: üß≠ Clonar repositorio
        uses: actions/checkout@v4

      # ==========================================================
      # üêç 2Ô∏è‚É£ CONFIGURAR PYTHON
      # ==========================================================
      - name: ‚öôÔ∏è Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: üì¶ Instalar dependencias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # ==========================================================
      # üîê 3Ô∏è‚É£ VARIABLES DE ENTORNO (CREDENCIALES)
      # ==========================================================
      - name: üîë Configurar variables secretas
        env:
          GOOGLE_CREDS_JSON: ${{ secrets.GOOGLE_CREDS_JSON }}
          SPREADSHEET_ID: ${{ secrets.SPREADSHEET_ID }}
          ALPHA_VANTAGE_KEY: ${{ secrets.ALPHA_VANTAGE_KEY }}
          ALERT_DEFAULT: ${{ secrets.ALERT_DEFAULT }}
        run: echo "‚úÖ Variables configuradas correctamente"

      # ==========================================================
      # ü§ñ 4Ô∏è‚É£ EJECUTAR BOT PRINCIPAL
      # ==========================================================
      - name: üß† Ejecutar bot.py
        env:
          GOOGLE_CREDS_JSON: ${{ secrets.GOOGLE_CREDS_JSON }}
          SPREADSHEET_ID: ${{ secrets.SPREADSHEET_ID }}
          ALPHA_VANTAGE_KEY: ${{ secrets.ALPHA_VANTAGE_KEY }}
          ALERT_DEFAULT: ${{ secrets.ALERT_DEFAULT }}
        run: |
          echo "‚ñ∂Ô∏è Ejecutando bot.py"
          python bot.py || echo "‚ö†Ô∏è Error detectado, se intentar√° en el siguiente ciclo."

      # ==========================================================
      # üìú 5Ô∏è‚É£ GUARDAR LOGS Y RESULTADOS
      # ==========================================================
      - name: üìä Finalizar ejecuci√≥n
        if: always()
        run: echo "‚úÖ Ejecuci√≥n finalizada correctamente ‚Äî $(date)"
